<?xml version="1.0" encoding="iso-8859-1"?>
<!-- 
	Authors: Axel Paccalin.
	Version: 0.1
	
	Controller to dampen d-alpha.
-->

<system name="Mirage-2000: FCS/FBW">
	<property value= "1">   fcs/fbw/pitch/damping/enable </property>  <!-- Pilot available toggle. -->
	
	<property value="0.01"> fcs/fbw/pitch/damping/Kp </property>  <!-- Tuning param (proportional coefficient for the controller). -->
	<property value="0.0"> fcs/fbw/pitch/damping/Kd </property>   <!-- Tuning param (derivative coefficient for the controller). -->
	
	<property value="0.8"> fcs/fbw/pitch/damping/max-authority </property>  <!-- Tuning param (absolute maximum output of the controller). -->

	<channel name="Pitch">
		
		<!-- Make Kp linear to (1-norm_IAS²) to account for authority due to speed. -->
		<fcs_function name="fcs/fbw/pitch/damping/Kpe">
			<function>
				<product>
					<p> fcs/fbw/energy-coefficient </p>
					<p> -fcs/fbw/pitch/damping/Kp </p>
				</product>
			</function>
		</fcs_function>

		<!-- Make Kd linear to (1-norm_IAS²) to account for authority due to speed. -->
		<fcs_function name="fcs/fbw/pitch/damping/Kde">
			<function>
				<product>
					<p> fcs/fbw/energy-coefficient </p> <!-- Speed² proportional factor -->
					<p> -fcs/fbw/pitch/damping/Kd </p>
				</product>
			</function>
		</fcs_function>

		<!-- PD controller for d-alpha damping on the pitch channel. No integration as it would interfere with the driver. -->
		<pid name="fcs/fbw/pitch/damping/controller">
			<input>fcs/fbw/pitch/d-alpha</input>
			
			<kp> fcs/fbw/pitch/damping/Kpe </kp>
			<ki> 0.0 </ki>
			<kd> fcs/fbw/pitch/damping/Kde </kd>
			
			<clipto>
				<p> -fcs/fbw/pitch/damping/max-authority </p>
				<p>  fcs/fbw/pitch/damping/max-authority </p>
			</clipto>
			
			<output>fcs/fbw/pitch/damping/output</output>
		</pid>

		<!-- Pilot available toggle implementation. -->
		<switch name="fcs/fbw/pitch/damping/active-output">
			<default value="0"/>
			<test logic="OR" value="fcs/fbw/pitch/damping/output">
				fcs/fbw/pitch/damping/enable eq 1
			</test>
		</switch>
	</channel>
</system>